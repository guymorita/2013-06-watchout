<html>
<head>
<style>
#container {
  border: 2px solid gray;
}
</style>
</head>
<body>
  <div id="container"></div>
  <script src="http://d3js.org/d3.v2.min.js?2.10.1"></script>
  <script>
  var width = 960;
  var height = 500;
  var pinkCollision = false;

  var data = [];

    data.push({"x": Math.random(), "y": Math.random(), "type": "pink"});
    data.push({"x": Math.random(), "y": Math.random(), "type": "pink"});
    data.push({"x": Math.random(), "y": Math.random(), "type": "pink"});

  var h = 1000;
  var svg = d3.select("#container").append("svg:svg")
    .attr("width", width)
    .attr("height", height)
    .style("pointer-events", "all")
    .on("mousemove", characterMove);

  var x = d3.scale.linear().domain([0,1]).range([width / 2 - 400,width / 2 + 400]),
  y = d3.scale.linear().domain([0,1]).range([0,height]),
  r = d3.scale.linear().domain([0,1]).range([5,10]),
  c = d3.scale.linear().domain([0,1]).range(["hsl(120, 50%, 50%)", "hsl(300, 100%, 75%)"]).interpolate(d3.interpolateHsl)

  //make a character
  svg.append("svg:circle")
      .attr("r", 15)
      .attr("class", "caesar")
      .attr("cx", width / 2)
      .attr("cy", height / 2)
      .attr("fill", "hsl(120, 120, 120)");

  function runDetection() {
    pinkCollision = false;
    svg.selectAll("circle#pink").each(collisionDetection)
    if (pinkCollision){
      console.log("collision!");
      data.push({"x": Math.random(), "y": Math.random(), "type": "pink"});
      update(data);

    }
    if(svg.selectAll("circle.blue").each(collisionDetection)) {

    }
  }
  //make function to move him around
  function characterMove() {
    var mouseLocation = d3.svg.mouse(this);
    svg.select("circle.caesar")
      .attr("cx", mouseLocation[0])
      .attr("cy", mouseLocation[1])
  }

  //collision detection function
  function collisionDetection() {
    var caesar = svg.select("circle.caesar");
    var enemy = d3.select(this);
    var sumOfRadii = parseInt(caesar.attr("r")) + parseInt(enemy.attr("r"));
    var caesarX = parseInt(caesar.attr("cx")),
        caesarY = parseInt(caesar.attr("cy")),
        enemyX  = parseInt(enemy.attr("cx")),
        enemyY  = parseInt(enemy.attr("cy"));
    var distance = Math.sqrt(Math.pow((caesarX - enemyX), 2) + Math.pow((caesarY - enemyY), 2));
    // console.log('distance', distance);
    // console.log('sum of radii', sumOfRadii);
    if (distance <= sumOfRadii) { pinkCollision = true;}
    
  }
  
  //function to create a dot
  svg.selectAll("circle")
      .data(data)
      .enter().append("svg:circle")
      .attr("class", "dots")
      .attr("id", function(d) { return d.type })
      .attr("cx", function(d) { return x(d.x) })
      .attr("cy", function(d) { return y(d.y) })
      .attr("stroke-width", "none")
      .attr("fill", function() { return c(Math.random()) })
      .attr("fill-opacity", .5)
      // .attr("visibility", "hidden")
      .attr("r", function() { return r(Math.random()) })

  function update(data){
    for ( var i = 0; i < data.length; i++) {
      data[i]["x"] = Math.random();
      data[i]["y"] = Math.random();
    }
    var newCircles = svg.selectAll("circle.dots")
        .data(data)
        .transition().duration(3000)
        .attr("cx", function(d) { return x(d.x) })
        .attr("cy", function(d) { return y(d.y) })
    //select the circle nodes
    //update their positional attributes
    newCircles.enter().append("circle")
      .attr("class", "dots")
      .attr("id", function(d) { return d.type })
      .attr("cx", function(d) { return x(d.x) })
      .attr("cy", function(d) { return y(d.y) })
      .attr("r", function() { return r(Math.random()) })


  }

setInterval(update, 3000);
setInterval(runDetection, 50);
  // var width = 960
  // var height = 500

  // var svg = d3.select("body")
  //   .append("svg")
  //     .attr("width", width)
  //     .attr("height", height)

  // function update(){
  //   var theCircle = d3.select("svg").append("circle")
  //     .attr("class", "enemy");
  // }
  // update();

  </script>
</body>
</html>





